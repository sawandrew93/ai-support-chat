<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>KB Admin</title>
  <link rel="stylesheet" href="kb.css" />
</head>
<body>
  <h3>Upload Document</h3>
  <div id="login">
    <input id="email" placeholder="email" />
    <input id="password" placeholder="password" type="password" />
    <button id="loginBtn">Login</button>
  </div>
  <div id="uploader" style="display:none;">
    <input type="file" id="file" />
    <button id="uploadBtn">Upload</button>
    <div id="out"></div>
  </div>

  <script>
  let token = null;
  const apiBase = location.origin;

  document.getElementById('loginBtn').onclick = async () => {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    const res = await fetch(apiBase + '/api/auth/login', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({ email, password }) });
    const data = await res.json();
    token = data.token;
    if (!token) return alert('Login failed');
    document.getElementById('login').style.display = 'none';
    document.getElementById('uploader').style.display = 'block';
  };

  document.getElementById('uploadBtn').onclick = async () => {
    const file = document.getElementById('file').files[0];
    if (!file) return alert('Pick a file');
    const fd = new FormData();
    fd.append('file', file);
    const res = await fetch(apiBase + '/api/documents/upload', { method: 'POST', headers: { 'authorization': 'Bearer ' + token }, body: fd });
    const data = await res.json();
    document.getElementById('out').textContent = JSON.stringify(data, null, 2);
  };
  </script>
</body>
</html>

